<!DOCTYPE html>
<html>
<head>
<title>Customer Master</title>

<style>
body{
font-family:Arial;
background:#eef2f7;
display:flex;
justify-content:center;
padding:40px;
}

.box{
background:#fff;
padding:30px;
width:500px;
border-radius:14px;
box-shadow:0 8px 25px rgba(0,0,0,0.08);
}

h2{
text-align:center;
color:#2d4a8a;
}

input{
width:100%;
padding:10px;
margin-top:6px;
margin-bottom:14px;
border:1px solid #ccc;
border-radius:6px;
}

button{
width:100%;
padding:12px;
border:none;
border-radius:6px;
font-weight:bold;
cursor:pointer;
margin-top:6px;
}

.save{ background:#2d4a8a; color:white; }
.delete{ background:#c0392b; color:white; }

.list{
background:#f7f7f7;
padding:10px;
border-radius:6px;
max-height:150px;
overflow:auto;
margin-bottom:15px;
}

.list div{
padding:6px;
cursor:pointer;
}

.list div:hover{
background:#ddd;
}
</style>
</head>
<body>

<div class="box">

<h2>Customer Master</h2>

<input id="search" placeholder="Search Firm..." onkeyup="searchCustomer()">

<div class="list" id="list"></div>

<input id="firm" placeholder="Firm Name">
<input id="person" placeholder="Person Name">
<input id="gstin" placeholder="GSTIN No">

<input id="gst" placeholder="GST Charges / Month" type="number">
<input id="audit" placeholder="Audit Fee" type="number">
<input id="itr" placeholder="ITR Fee" type="number">

<input id="otherTitle" placeholder="Other Fee Title">
<input id="otherAmount" placeholder="Other Fee Amount" type="number">

<button class="save" onclick="saveCustomer()">Save / Update</button>
<button class="delete" onclick="deleteCustomer()">Delete</button>

</div>

<script>

/* ====== PUT YOUR WORKER URL ====== */
const API = "https://backend.rajeevyadav2596.workers.dev";

let customers = [];
let selectedId = null;

/* LOAD CUSTOMERS */
async function loadCustomers(){

const res = await fetch(API + "/api/customers");
customers = await res.json();
renderList(customers);

}

/* RENDER LIST */
function renderList(data){

list.innerHTML="";

data.forEach(c=>{
let div=document.createElement("div");
div.innerText=`${c.firm_name} - ${c.person_name}`;
div.onclick=()=>selectCustomer(c);
list.appendChild(div);
});

}

/* SELECT CUSTOMER */
function selectCustomer(c){

selectedId=c.id;

firm.value=c.firm_name;
person.value=c.person_name;
gstin.value=c.gstin||"";
gst.value=c.gst_charges||0;
audit.value=c.audit_fee||0;
itr.value=c.itr_fee||0;
otherTitle.value=c.other_fee_name||"";
otherAmount.value=c.other_fee_amount||0;

}

/* SEARCH */
function searchCustomer(){

let k=search.value.toLowerCase();

renderList(
customers.filter(c=>
c.firm_name.toLowerCase().includes(k)
)
);

}

/* SAVE */
async function saveCustomer(){

await fetch(API+"/api/add-customer",{
method:"POST",
headers:{ "Content-Type":"application/json" },
body:JSON.stringify({
id:selectedId,
firm:firm.value,
person:person.value,
gstin:gstin.value,
gst:gst.value,
audit:audit.value,
itr:itr.value,
other_name:otherTitle.value,
other_amount:otherAmount.value
})
});

alert("Saved");
location.reload();

}

/* DELETE */
async function deleteCustomer(){

if(!selectedId) return alert("Select customer");

if(!confirm("Delete this customer?")) return;

await fetch(API+"/api/delete-customer",{
method:"POST",
headers:{ "Content-Type":"application/json" },
body:JSON.stringify({ id:selectedId })
});

alert("Deleted");
location.reload();

}

loadCustomers();

</script>

</body>
</html>
