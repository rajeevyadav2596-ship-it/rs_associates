<!DOCTYPE html>
<html>
<head>
<title>Receipt Entry</title>

<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>

body{
font-family:Segoe UI;
background:#eef2f7;
margin:0;
padding:15px;
}

/* CARD */

.card{
background:white;
padding:22px;
border-radius:14px;
max-width:500px;
margin:auto;
box-shadow:0 6px 20px rgba(0,0,0,0.08);
}

h2{
margin-top:0;
text-align:center;
}

/* FORM */

label{
font-weight:600;
display:block;
margin-top:14px;
}

input,select{
width:100%;
padding:11px;
margin-top:6px;
border:1px solid #ccc;
border-radius:6px;
font-size:15px;
}

/* BUTTONS */

button{
width:100%;
padding:13px;
border:none;
border-radius:7px;
color:white;
font-weight:600;
margin-top:18px;
cursor:pointer;
font-size:15px;
}

.saveBtn{
background:#2d4a8a;
}

.saveBtn:hover{
background:#1f3c88;
}

.deleteBtn{
background:#c0392b;
}

.deleteBtn:hover{
background:#962d22;
}

/* MOBILE */

@media(max-width:600px){
.card{
padding:18px;
}
}

</style>
</head>

<body>

<div class="card">

<h2>Receipt Entry</h2>

<label>Receipt No</label>
<input id="receiptNo" readonly>

<label>Firm</label>
<select id="firm"></select>

<label>Receipt Date</label>
<input type="date" id="date">

<label>Amount</label>
<input type="number" id="amount" placeholder="Enter Amount">

<label>Nature of Payment</label>
<select id="nature">
<option>Google Pay</option>
<option>PhonePe</option>
<option>Paytm</option>
<option>UPI</option>
<option>Cash</option>
<option>Bank</option>
<option>Cheque</option>
<option>Adjustment</option>
</select>

<button class="saveBtn" onclick="saveReceipt()">Save Receipt</button>
<button class="deleteBtn" onclick="deleteReceipt()">Delete Receipt</button>

</div>

<script>

const API="https://backend.rajeevyadav2596.workers.dev";

let editReceiptNo=null;

/* ================= LOAD FIRMS ================= */

async function loadFirms(){

const res = await fetch(API+"/api/customers");
const data = await res.json();

firm.innerHTML='<option value="">Select Firm</option>';

data.forEach(c=>{
firm.innerHTML+=`
<option value="${c.id}">
${c.firm_name} - ${c.person_name}
</option>`;
});

}

/* ================= DEFAULT DATE ================= */

date.value = new Date().toISOString().split("T")[0];

/* ================= LOAD RECEIPT IF EDIT ================= */

async function loadReceiptIfEdit(){

const params=new URLSearchParams(window.location.search);
const no=params.get("receipt");

if(!no) return;

editReceiptNo=no;

const res=await fetch(API+"/api/receipt/"+no);
const d=await res.json();

if(!d || !d.receipt_no){
alert("Receipt not found");
return;
}

receiptNo.value=d.receipt_no;
firm.value=d.customer_id;
date.value=d.date;
amount.value=d.amount;
nature.value=d.nature;

}

/* ================= SAVE (INSERT OR UPDATE) ================= */

async function saveReceipt(){

if(!firm.value){
alert("Select Firm");
return;
}

if(!amount.value){
alert("Enter Amount");
return;
}

const res = await fetch(API+"/api/add-receipt",{
method:"POST",
headers:{ "Content-Type":"application/json" },
body:JSON.stringify({

receipt_no: editReceiptNo,   // enables update
customer_id: firm.value,
amount: amount.value,
nature: nature.value,
date: date.value

})
});

const data = await res.json();

receiptNo.value = data.receipt_no;
editReceiptNo = data.receipt_no;

alert(data.updated ? "Receipt Updated ✅" : "Receipt Saved ✅");

}

/* ================= DELETE RECEIPT ================= */

async function deleteReceipt(){

if(!editReceiptNo){
alert("No receipt selected");
return;
}

const confirmDelete = confirm(
"Are you sure you want to delete this receipt?\nThis action cannot be undone."
);

if(!confirmDelete) return;

await fetch(API+"/api/delete-receipt",{
method:"POST",
headers:{ "Content-Type":"application/json" },
body:JSON.stringify({
receipt_no: editReceiptNo
})
});

alert("Receipt Deleted ✅");

/* Redirect back to ledger */
window.location.href="ledger.html";

}

/* ================= INIT ================= */

async function init(){
await loadFirms();
await loadReceiptIfEdit();
}

init();

</script>

</body>
</html>
