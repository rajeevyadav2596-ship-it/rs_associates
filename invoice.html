<!DOCTYPE html>
<html>
<head>
<title>Create Invoice</title>

<style>
body{
font-family:Calibri;
background:#eef2f7;
padding:40px;
}

.card{
background:white;
padding:30px;
border-radius:10px;
width:900px;
margin:auto;
box-shadow:0 4px 12px rgba(0,0,0,0.1);
}

table{
width:100%;
border-collapse:collapse;
}

td{
padding:10px;
border-bottom:1px solid #eee;
}

input,select{
width:100%;
padding:8px;
border:1px solid #ccc;
border-radius:4px;
}

.heading{
font-size:22px;
font-weight:bold;
margin-bottom:20px;
color:#1f3c88;
}

.total{
font-size:18px;
font-weight:bold;
color:#000;
}
</style>
</head>

<body>

<div class="card">

<div class="heading">
RS Associates â€“ Invoice
</div>

<table>

<tr>
<td>Customer Name</td>
<td>
<select id="firm"></select>
</td>
</tr>

<tr>
<td>Person Name</td>
<td><input id="person" readonly></td>
</tr>

<tr>
<td><b>Invoice No.</b></td>
<td><input id="invoiceNo" readonly></td>
</tr>

<tr>
<td><b>Time Period</b></td>
<td>
<input type="month" id="from">
to
<input type="month" id="to">
</td>
</tr>

<tr>
<td>GST Fees (Per Month)</td>
<td><input id="gst" readonly></td>
</tr>

<tr>
<td>GST Charges</td>
<td id="gstTotal">Auto Calculated</td>
</tr>

<tr>
<td>Audit Charges</td>
<td id="auditTotal">Auto Calculated</td>
</tr>

<tr>
<td>Other Charges / TDS</td>
<td><input id="other"></td>
</tr>

<tr>
<td>ITR</td>
<td><input id="itr"></td>
</tr>

<tr>
<td class="total">Final Bill</td>
<td class="total" id="finalBill"></td>
</tr>

</table>

<button onclick="generate()">Generate Invoice</button>

</div>

<script>

const API="https://backend.rajeevyadav2596.workers.dev";

let customers=[];


/* AUTO INVOICE NUMBER */
fetch(API+"/api/next-invoice")
.then(r=>r.json())
.then(d=>{
invoiceNo.value=d.invoice_no;
});


/* LOAD CUSTOMERS */
fetch(API+"/api/customers")
.then(r=>r.json())
.then(d=>{
customers=d;

d.forEach(c=>{
firm.innerHTML+=
`<option value="${c.firm_name}">
${c.firm_name}
</option>`;
});
});


/* AUTO FETCH PERSON + GST */
firm.onchange=function(){

let c=
customers.find(x=>x.firm_name===firm.value);

person.value=c.person_name;
gst.value=c.gst_rate;

};


/* CALCULATE */
function generate(){

let f=new Date(from.value);
let t=new Date(to.value);

let months=
(t.getFullYear()-f.getFullYear())*12+
(t.getMonth()-f.getMonth())+1;

let gstT=
months*(+gst.value||0);

let auditT=
months*(+customers
.find(x=>x.firm_name===firm.value)
.audit_rate||0);

gstTotal.innerHTML=gstT;
auditTotal.innerHTML=auditT;

let final=
gstT+auditT+
(+other.value||0)+
(+itr.value||0);

finalBill.innerHTML=final;

}
</script>

</body>
</html>
