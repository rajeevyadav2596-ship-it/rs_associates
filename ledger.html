<script>

const API="https://backend.rajeevyadav2596.workers.dev";

/* LOAD LEDGER */
async function loadLedger(){

const id=firmSelect.value;

const res=await fetch(API+"/api/ledger-dashboard");
const data=await res.json();

const firmData=data.filter(x=>x.customer_id==id);

let balance=0;
tbody.innerHTML="";

firmData.forEach(d=>{

let particular="";
let invoice="";
let receipt="";

if(d.invoice_amount>0){

particular=
monthText(d.period_from)+" to "+
monthText(d.period_to);

invoice="₹"+d.invoice_amount;
balance+=d.invoice_amount;
}

if(d.receipt_amount>0){

particular=d.type;
receipt="₹"+d.receipt_amount;
balance-=d.receipt_amount;
}

tbody.innerHTML+=`
<tr>
<td>${formatDate(d.date)}</td>
<td>${particular}</td>
<td>${invoice}</td>
<td>${receipt}</td>
<td>₹${balance}</td>
</tr>`;
});

}

function monthText(m){
if(!m) return "";
return new Date(m).toLocaleString("en-GB",{month:"short",year:"2-digit"});
}

function formatDate(d){
return new Date(d).toLocaleDateString("en-GB");
}

</script>
